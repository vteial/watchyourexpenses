angular.module("angular-table",[]).directive("angularTable",["ScrollingContainerHeightState","JqLiteExtension","SortState","ResizeHeightEvent","TemplateStaticState","Instrumentation",function(f,a,c,b,d,g){return{restrict:"E",compile:function(a,h){c.sortExpression=h.defaultSortColumn;d.instrumentationEnabled=h.instrumentationEnabled;a.addClass("angularTableContainer");var j=a[0].outerHTML.replace("<angular-table","<div"),j=j.replace("</angular-table>","</div>");a.replaceWith(j);return function(a,c){a.ResizeHeightEvent=
b;var e=function(){f.outerContainerComputedHeight=c[0].clientHeight;g.log("angularTable","outer container computed height measured",f.outerContainerComputedHeight)};a.$watch("ResizeHeightEvent",function(){e()},!0);e()}},scope:{model:"="}}}]).directive("headerRow",["ManualCompiler","ScrollingContainerHeightState","JqLiteExtension","SortState","ResizeHeightEvent","ResizeWidthEvent","Instrumentation",function(f,a,c,b,d,g,e){return{restrict:"E",controller:["$scope","$parse",function(a){a.SortState=b;
a.setSortExpression=function(a){b.sortExpression=a;b.sortDirectionToColumnMap[b.sortExpression]=!b.sortDirectionToColumnMap[b.sortExpression]}}],compile:function(a,b){f.compileRow(a,b,!0);return function(a,b){a.ResizeHeightEvent=d;a.ResizeWidthEvent=g;a.$watch("ResizeWidthEvent",function(){var a=c.getComputedWidthAsFloat(b.next()[0]);b.css("width",a+"px");e.log("headerRow","header width set",a+"px")},!0)}}}}]).directive("row",["ManualCompiler","ResizeHeightEvent","$window","Debounce","TemplateStaticState",
"RowState","SortState","ScrollingContainerHeightState","JqLiteExtension","Instrumentation","ResizeWidthEvent",function(f,a,c,b,d,g,e,h,j,l,k){return{restrict:"E",controller:["$scope",function(a){a.sortExpression=e.sortExpression;a.handleClick=function(b,c,e){c=c.replace("(row)","");"undefined"!==e&&(g.previouslySelectedRow.rowSelected=!1,b.rowSelected=!0,g.previouslySelectedRow=b);if("undefined"!==c)a.$parent[c](b)};a.getRowColor=function(a,b){return b.rowSelected?d.selectedRowColor:0===a%2?d.evenRowColor:
d.oddRowColor}}],compile:function(d,m){g.rowSelectedBackgroundColor=m.selectedColor;f.compileRow(d,m,!1);return function(d,f){d.ScrollingContainerHeightState=h;d.SortState=e;angular.element(c).bind("resize",b.debounce(function(){d.$apply(function(){a.fireTrigger=!a.fireTrigger;k.fireTrigger=!k.fireTrigger;l.log("row","debounced window resize triggered")})},50));d.$watch("ResizeHeightEvent",function(){var a=j.getComputedHeightAsFloat(f.parent()[0]),b=j.getComputedHeightAsFloat(angular.element(f.parent().children()[0])[0]),
a=a-b;f.css("height",a+"px");l.log("row","scrolling container height set",a+"px")},!0);d.$watch("SortState",function(){f[0].scrollTop=0},!0);d.$watch("model",function(){a.fireTrigger=!a.fireTrigger;k.fireTrigger=!k.fireTrigger},!0)}}}}]).service("Debounce",function(){this.debounce=function(f,a,c){var b,d;return function(){var g=this,e=arguments,h=c&&!b;clearTimeout(b);b=setTimeout(function(){b=null;c||(d=f.apply(g,e))},a);h&&(d=f.apply(g,e));return d}};return this}).service("JqLiteExtension",["$window",
function(f){var a=this;a.getComputedPropertyAsFloat=function(a,b){var d=f.getComputedStyle(a).getPropertyValue(b).replace("px","");return parseFloat(d)};a.getComputedWidthAsFloat=function(c){return a.getComputedPropertyAsFloat(c,"width")};a.getComputedHeightAsFloat=function(c){return a.getComputedPropertyAsFloat(c,"height")};return a}]).service("ManualCompiler",["TemplateStaticState",function(f){this.compileRow=function(a,c,b){var d="",g="";b&&(d="Header",g="header-");a.addClass("angularTable"+d+
"Row");a.children().addClass("angularTable"+d+"Column");b&&angular.forEach(a.children(),function(a){"true"===angular.element(a).attr("sortable")&&(angular.element(a).find("sort-arrow-descending").attr("ng-show","SortState.sortExpression == '"+angular.element(a).attr("sort-field-name")+"' && !SortState.sortDirectionToColumnMap['"+angular.element(a).attr("sort-field-name")+"']").addClass("angularTableDefaultSortArrowAscending"),angular.element(a).find("sort-arrow-ascending").attr("ng-show","SortState.sortExpression == '"+
angular.element(a).attr("sort-field-name")+"' && SortState.sortDirectionToColumnMap['"+angular.element(a).attr("sort-field-name")+"']").addClass("angularTableDefaultSortArrowDescending"),angular.element(a).attr("ng-click","setSortExpression('"+angular.element(a).attr("sort-field-name")+"')"),angular.element(a).removeAttr("sort-field-name"))});if(b)var e=a[0].outerHTML.replace("<header-row","<tr"),e=e.replace("/header-row>","/tr>");else e=a[0].outerHTML.replace("<row","<tr"),e=e.replace("/row>","/tr>");
e=e.replace(RegExp(g+"column","g"),"td");if(b)e=e.replace(/sort-arrow-descending/g,"div"),e=e.replace(/sort-arrow-ascending/g,"div");else{b="";f.selectedRowColor=c.selectedColor;f.evenRowColor=c.evenColor;f.oddRowColor=c.oddColor;if("undefined"!==typeof c.selectedColor||"undefined"!==typeof c.evenColor||"undefined"!==typeof c.oddColor)b='ng-style="{ backgroundColor: getRowColor($index, row) }"';e=e.replace("<tr",'<tr ng-repeat="row in model | orderBy:SortState.sortExpression:SortState.sortDirectionToColumnMap[SortState.sortExpression]" '+
b+" ng-click=\"handleClick(row, '"+c.onSelected+"', '"+c.selectedColor+"')\" ")}a.replaceWith('<div class="angularTable'+d+'TableContainer"><table class="angularTable'+d+'Table">'+e+"</table></div>")}}]).service("ResizeHeightEvent",function(){this.fireTrigger=!1;return this}).service("ResizeWidthEvent",function(){this.fireTrigger=!1;return this}).service("ScrollingContainerHeightState",function(){this.headerComputedHeight=this.outerContainerComputedHeight=0;return this}).service("TemplateStaticState",
function(){this.oddRowColor=this.evenRowColor=this.selectedRowColor="";return this}).service("RowState",function(){this.previouslySelectedRow={};this.previouslySelectedRowColor="";return this}).service("SortState",function(){this.sortExpression="";this.sortDirectionToColumnMap={};return this}).service("Instrumentation",["TemplateStaticState","$log",function(f,a){this.log=function(c,b,d){f.instrumentationEnabled&&(a.log("Source: "+c),a.log("Event: "+b),a.log("Value: "+d),a.log("------------------------\n"))};
return this}]);
